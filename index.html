<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Managers & Directors Summit Registration - Campus Stores Canada</title>
    <link rel="icon" type="image/png" href="https://images.squarespace-cdn.com/content/v1/5ec55d5d28a93e0e18d2eeb4/1600096854522-HS7NUI12I1ML6SPJFLLY/Artboard+1.png?format=1500w">

    <!-- External Fonts -->
    <link rel="stylesheet" href="https://use.typekit.net/ilr6ctr.css">

    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="vendor-wizard.css">

    <!-- Signature Pad Library -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>

    <!-- Summit-Specific Styles -->
    <style>
        /* Layout Adjustments for Summit Registration */
        .welcome-section {
            width: 65% !important;
            max-width: 800px;
            margin-top: 80px !important;
        }

        .welcome-title {
            font-size: 2.5vw !important;
            margin-bottom: 25px !important;
        }

        /* Constrain width of step sections to match welcome section */
        .content-section:not(#welcomeSection) {
            max-width: 800px;
            width: 65%;
            margin-left: 0;
            margin-right: auto;
        }

        .content-section h1 {
            font-size: 2.2vw;
            margin-bottom: 1.5em;
        }

        .content-section .progress-indicator {
            margin-bottom: 2em;
        }

        /* Scrollable Agreement Container */
        .scroll-to-accept-container {
            position: relative;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 2em;
            margin: 0.5em 0 1.5em 0;
            background: #f8f9fa;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            transition: box-shadow 0.3s ease;
        }

        .scroll-to-accept-container.pulse {
            animation: pulse-red 2s ease-in-out infinite;
        }

        .scroll-to-accept-container .agreement-content {
            background: transparent;
            padding: 0;
            margin: 0;
            border: none;
            max-height: none;
            overflow: visible;
        }

        .scroll-indicator {
            position: sticky;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(248, 249, 250, 1) 60%, rgba(248, 249, 250, 0));
            padding: 1.5em 1em 0.5em;
            text-align: center;
            font-weight: 600;
            color: #0071bc;
            font-size: 0.95em;
            pointer-events: none;
            transition: opacity 0.3s ease;
            animation: pulse-scroll 2s ease-in-out infinite;
        }

        .scroll-indicator.hidden {
            opacity: 0;
            animation: none;
        }

        /* Red pulse animation for areas that need attention */
        @keyframes pulse-red {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4), inset 0 2px 4px rgba(0,0,0,0.05);
                border-color: #dee2e6;
            }
            50% {
                box-shadow: 0 0 0 8px rgba(220, 53, 69, 0), inset 0 2px 4px rgba(0,0,0,0.05);
                border-color: rgba(220, 53, 69, 0.5);
            }
        }

        /* Pulse animation for scroll indicator (subtle) */
        @keyframes pulse-scroll {
            0%, 100% {
                opacity: 1;
                transform: translateY(0);
            }
            50% {
                opacity: 0.6;
                transform: translateY(-3px);
            }
        }

        .checkbox-item {
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .checkbox-item.pulse {
            animation: pulse-red 2s ease-in-out infinite;
            padding: 0.5em;
            margin: -0.5em;
        }

        .checkbox-item input[type="checkbox"]:disabled + label {
            opacity: 0.4;
            cursor: not-allowed;
            color: #999;
        }

        .checkbox-item input[type="checkbox"]:disabled {
            cursor: not-allowed;
            opacity: 0.4;
        }

        .checkbox-item input[type="checkbox"]:not(:disabled) + label {
            opacity: 1;
            color: inherit;
        }

        /* Disabled Next Button Styling */
        .next-btn:disabled {
            background: #cccccc !important;
            color: #666666 !important;
            cursor: not-allowed !important;
            opacity: 0.6;
        }

        .next-btn:disabled:hover {
            background: #cccccc !important;
        }

        /* Serious/Confidential Tone Styling */
        .summit-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1.5em;
            margin: 2em 0;
            border-radius: 4px;
        }

        .summit-critical {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 1.5em;
            margin: 2em 0;
            border-radius: 4px;
        }

        .summit-info {
            background: #d1ecf1;
            border-left: 4px solid #0c5460;
            padding: 1.5em;
            margin: 2em 0;
            border-radius: 4px;
        }

        .agreement-text {
            background: #f8f9fa;
            padding: 2em;
            margin: 1.5em 0;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.8;
        }

        .agreement-text h3 {
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            color: #2c3e50;
        }

        .agreement-text p {
            margin-bottom: 1em;
        }

        .agreement-text ul {
            margin-left: 2em;
            margin-bottom: 1em;
        }

        .agreement-content {
            margin: 2em 0;
            line-height: 1.7;
            color: #333333;
        }

        .agreement-content h3 {
            font-family: 'davis-sans', sans-serif;
            font-weight: 600;
            font-size: 1.1em;
            color: #000000;
            margin-top: 1.8em;
            margin-bottom: 0.8em;
        }

        .agreement-content h3:first-child {
            margin-top: 0;
        }

        .agreement-content p {
            margin-bottom: 1.1em;
            line-height: 1.7;
        }

        .agreement-content ul {
            margin-bottom: 1.2em;
            margin-left: 1.8em;
        }

        .agreement-content li {
            margin-bottom: 0.5em;
            line-height: 1.6;
        }

        .checkbox-group {
            margin: 1.5em 0;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1em;
            padding: 1em;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover {
            border-color: #0071bc;
        }

        .checkbox-item.checked {
            border-color: #28a745;
            background: #f8fff9;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 1em;
            margin-top: 0.3em;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            flex: 1;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .file-upload-area {
            margin: 2em 0;
            padding: 2em;
            border: 2px dashed #ced4da;
            border-radius: 8px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: #0071bc;
            background: #f0f8ff;
        }

        .file-upload-area.has-file {
            border-color: #28a745;
            background: #f8fff9;
            border-style: solid;
        }

        .file-upload-label {
            display: block;
            cursor: pointer;
            padding: 1em;
        }

        .file-upload-input {
            display: none;
        }

        .file-name-display {
            margin-top: 1em;
            padding: 0.8em;
            background: white;
            border-radius: 4px;
            font-weight: 500;
            color: #28a745;
        }

        .radio-group {
            margin: 1.5em 0;
        }

        .radio-item {
            display: flex;
            align-items: center;
            margin-bottom: 1em;
            padding: 1.2em;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radio-item:hover {
            border-color: #0071bc;
        }

        .radio-item.selected {
            border-color: #0071bc;
            background: #f0f8ff;
        }

        .radio-item input[type="radio"] {
            margin-right: 1em;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .radio-item label {
            cursor: pointer;
            flex: 1;
            font-weight: 500;
        }

        .explanation-text {
            color: #6c757d;
            font-size: 0.9em;
            font-style: italic;
            margin-top: 0.5em;
            line-height: 1.5;
        }

        .contact-selection {
            margin: 2em 0;
        }

        .contact-card {
            padding: 1.2em;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 1em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .contact-card:hover {
            border-color: #0071bc;
        }

        .contact-card.selected {
            border-color: #0071bc;
            background: #f0f8ff;
        }

        .contact-name {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 0.3em;
        }

        .contact-details {
            color: #6c757d;
            font-size: 0.9em;
        }

        .add-new-person-btn {
            padding: 1em;
            background: #f8f9fa;
            border: 2px dashed #ced4da;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-new-person-btn:hover {
            border-color: #0071bc;
            background: #f0f8ff;
        }

        .new-person-form {
            margin-top: 1.5em;
            padding: 1.5em;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .form-field {
            margin-bottom: 1.2em;
        }

        .form-field label {
            display: block;
            margin-bottom: 0.5em;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-field input {
            width: 100%;
            padding: 0.8em;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1em;
        }

        .form-field input:focus {
            outline: none;
            border-color: #0071bc;
            box-shadow: 0 0 0 3px rgba(0, 113, 188, 0.1);
        }

        .field-error {
            color: #dc3545;
            font-size: 0.85em;
            margin-top: 0.3em;
            display: none;
        }

        .field-error.visible {
            display: block;
        }

        .progress-indicator {
            margin-bottom: 2em;
            padding: 1em;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .progress-text {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 0.5em;
        }

        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0071bc, #00a4e4);
            transition: width 0.3s ease;
        }

        /* Primary Member Verification Section */
        .primary-member-section {
            margin: 2em 0;
            padding: 0;
        }

        .primary-member-section h3 {
            font-family: 'davis-sans', sans-serif;
            font-weight: 600;
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 1em;
        }

        .primary-member-card {
            background: #ffffff;
            border: 2px solid #0071bc;
            border-radius: 8px;
            padding: 1.5em;
            margin-bottom: 1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1.5em;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-family: 'davis-sans', sans-serif;
            font-weight: 600;
            font-size: 1.2em;
            color: #000000;
            margin-bottom: 0.3em;
        }

        .member-title,
        .member-email,
        .member-phone {
            font-size: 0.95em;
            color: #495057;
            margin-bottom: 0.25em;
        }

        .edit-details-btn {
            background: #ffffff;
            color: #0071bc;
            border: 2px solid #0071bc;
            padding: 0.7em 1.5em;
            border-radius: 6px;
            font-family: 'davis-sans', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .edit-details-btn:hover {
            background: #0071bc;
            color: #ffffff;
        }

        .verification-prompt {
            font-size: 0.9em;
            color: #6c757d;
            font-style: italic;
            margin-top: 0.5em;
        }

        /* Edit Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #ffffff;
            border-radius: 12px;
            padding: 2em;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5em;
            padding-bottom: 1em;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-title {
            font-family: 'davis-sans', sans-serif;
            font-weight: 600;
            font-size: 1.4em;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            color: #6c757d;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: #000000;
        }

        .modal-body {
            margin-bottom: 1.5em;
        }

        .modal-field {
            margin-bottom: 1.2em;
        }

        .modal-field label {
            display: block;
            font-family: 'davis-sans', sans-serif;
            font-weight: 500;
            font-size: 0.95em;
            color: #2c3e50;
            margin-bottom: 0.5em;
        }

        .modal-field label .required {
            color: #dc3545;
        }

        .modal-field input {
            width: 100%;
            padding: 0.8em;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-family: 'davis-sans', sans-serif;
            font-size: 1em;
            transition: border-color 0.2s ease;
        }

        .modal-field input:focus {
            outline: none;
            border-color: #0071bc;
            box-shadow: 0 0 0 3px rgba(0, 113, 188, 0.1);
        }

        .modal-field input.error {
            border-color: #dc3545;
        }

        .modal-field .error-message {
            color: #dc3545;
            font-size: 0.85em;
            margin-top: 0.3em;
            display: none;
        }

        .modal-field .error-message.visible {
            display: block;
        }

        .modal-footer {
            display: flex;
            gap: 1em;
            justify-content: flex-end;
        }

        .modal-cancel-btn,
        .modal-save-btn {
            padding: 0.8em 1.5em;
            border-radius: 6px;
            font-family: 'davis-sans', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid;
        }

        .modal-cancel-btn {
            background: #ffffff;
            color: #6c757d;
            border-color: #6c757d;
        }

        .modal-cancel-btn:hover {
            background: #6c757d;
            color: #ffffff;
        }

        .modal-save-btn {
            background: #0071bc;
            color: #ffffff;
            border-color: #0071bc;
        }

        .modal-save-btn:hover {
            background: #005a94;
            border-color: #005a94;
        }

        /* Signature Modal */
        .signature-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .signature-modal-overlay.active {
            display: flex;
        }

        .signature-modal-content {
            background: #ffffff;
            border-radius: 12px;
            padding: 2em;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .signature-modal-header {
            margin-bottom: 1.5em;
            padding-bottom: 1em;
            border-bottom: 2px solid #e9ecef;
        }

        .signature-modal-title {
            font-family: 'davis-sans', sans-serif;
            font-weight: 600;
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 0.5em;
        }

        .signature-modal-subtitle {
            color: #666;
            font-size: 0.95em;
        }

        .signature-modal-body {
            margin-bottom: 1.5em;
        }

        .signature-modal-footer {
            display: flex;
            gap: 1em;
            justify-content: flex-end;
        }

        .sign-agreement-btn {
            background: #0071bc;
            color: #ffffff;
            border: 2px solid #0071bc;
            padding: 1em 2em;
            border-radius: 6px;
            font-family: 'davis-sans', sans-serif;
            font-weight: 600;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 1.5em 0;
            width: 100%;
            text-align: center;
        }

        .sign-agreement-btn:hover:not(:disabled) {
            background: #005a94;
            border-color: #005a94;
        }

        .sign-agreement-btn:disabled {
            background: #cccccc;
            border-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .sign-agreement-btn.signed {
            background: #28a745;
            border-color: #28a745;
        }

        .sign-agreement-btn.signed:hover {
            background: #218838;
            border-color: #218838;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .welcome-section {
                width: 100% !important;
                margin-top: 40px !important;
            }

            .welcome-title {
                font-size: 6vw !important;
            }

            .content-section:not(#welcomeSection) {
                width: 100%;
                max-width: none;
            }

            .content-section h1 {
                font-size: 6vw;
            }

            .scroll-to-accept-container {
                max-height: 300px;
                padding: 1.5em;
                margin: 0.5em 0 1em 0;
            }

            .primary-member-card {
                flex-direction: column;
                align-items: stretch;
                gap: 1em;
            }

            .edit-details-btn {
                width: 100%;
                text-align: center;
            }

            .modal-content {
                padding: 1.5em;
            }

            .modal-footer {
                flex-direction: column-reverse;
            }

            .modal-cancel-btn,
            .modal-save-btn {
                width: 100%;
            }
        }

        /* Designate Button Styling */
        .designate-button-wrapper {
            width: 8vw;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-top: 0.1vw;
            position: relative;
            z-index: 2;
            pointer-events: auto;
        }

        .designate-btn {
            background: #0071bc;
            color: white;
            border: 2px solid #0071bc;
            padding: 0.4vw 0.8vw;
            border-radius: 4px;
            font-family: 'davis-sans', sans-serif;
            font-size: 0.85vw;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .designate-btn:hover {
            background: #005a94;
            border-color: #005a94;
        }

        .designate-btn.designated {
            background: #28a745;
            border-color: #28a745;
        }

        .designate-btn.designated:hover {
            background: #218838;
            border-color: #218838;
        }

        /* Dietary Restrictions Display */
        .contact-dietary {
            font-family: 'davis-sans', sans-serif;
            font-size: 0.8vw;
            color: #999;
            font-style: italic;
            margin-top: 0.2vw;
            grid-column: 1 / -1;
            grid-row: 3;
        }

        /* Tablet responsive adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .welcome-section {
                width: 70% !important;
            }

            .welcome-title {
                font-size: 3vw !important;
            }

            .content-section:not(#welcomeSection) {
                width: 70%;
            }

            .content-section h1 {
                font-size: 3vw;
            }

            .designate-btn {
                font-size: 1.1vw;
                padding: 0.5vw 1vw;
            }

            .contact-dietary {
                font-size: 1vw;
            }
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <!-- Loading State -->
        <div id="loadingState" class="loading active">
            <div class="loading-title">
                Loading<span class="dots">
                    <span class="dot">.</span>
                    <span class="dot">.</span>
                    <span class="dot">.</span>
                </span>
            </div>
        </div>

        <!-- Upload Animation State -->
        <div class="uploading-state" id="uploadingState">
            <div class="uploading-title">
                Uploading<span class="dots">
                    <span class="dot">.</span>
                    <span class="dot">.</span>
                    <span class="dot">.</span>
                </span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="wizard-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="logo-section">
                    <div class="logo-container">
                        <img src="https://images.squarespace-cdn.com/content/v1/5ec55d5d28a93e0e18d2eeb4/1600096854522-HS7NUI12I1ML6SPJFLLY/Artboard+1.png?format=1500w" alt="CSC Logo" class="csc-logo">
                        <div id="organizationLogo" class="organization-logo-container"></div>
                    </div>
                </div>
                <h2 class="sidebar-title">Managers & Directors Summit</h2>
                <div class="step-indicators">
                    <div class="step-indicator active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Your Attendance</div>
                    </div>
                    <div class="step-indicator" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Format & Agreement</div>
                    </div>
                    <div class="step-indicator" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Designate Alternate</div>
                    </div>
                    <div class="step-indicator" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Confirmation</div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Mobile Progress Bar -->
                <div class="mobile-progress">
                    <div class="mobile-progress-fill" style="width: 0%"></div>
                </div>

                <!-- Welcome Section -->
                <div id="welcomeSection" class="content-section active">
                    <div class="welcome-container">
                        <div class="welcome-section">
                            <h1 class="welcome-title">Managers & Directors Summit Registration</h1>

                            <div class="summit-info">
                                <p><strong>This is a highly confidential meeting requiring explicit agreements at multiple decision points.</strong></p>
                                <p>This registration process will guide you through several important decisions and require your acknowledgment of strict confidentiality requirements.</p>
                            </div>

                            <div class="summit-warning">
                                <p><strong>Before you begin:</strong></p>
                                <ul>
                                    <li>You will need to review and sign confidentiality agreements</li>
                                    <li>All checkboxes and agreements are required - no exceptions</li>
                                    <li>This process should take 10-15 minutes to complete</li>
                                </ul>
                            </div>

                            <!-- Primary Member Verification -->
                            <div id="primaryMemberSection" class="primary-member-section" style="display: none;">
                                <h3>We're registering:</h3>
                                <div class="primary-member-card">
                                    <div class="member-info">
                                        <div class="member-name" id="pmDisplayName">Loading...</div>
                                        <div class="member-title" id="pmDisplayTitle">-</div>
                                        <div class="member-email" id="pmDisplayEmail">-</div>
                                        <div class="member-phone" id="pmDisplayPhone">-</div>
                                    </div>
                                    <button class="edit-details-btn" onclick="openPrimaryMemberModal()">
                                        Edit Details
                                    </button>
                                </div>
                                <p class="verification-prompt">Please verify your information is correct before proceeding.</p>
                            </div>

                            <button class="get-started-btn" onclick="startWizard()">
                                Begin Registration <span>→</span>
                            </button>
                        </div>
                    </div>
                </div>

            <!-- Step 1: Attendance Decision (Primary Member) -->
            <div id="step2Section" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 1 of 4</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 25%;"></div>
                    </div>
                </div>

                <h1>Will You Be Attending?</h1>

                <div class="radio-group">
                    <p style="font-weight: 600; margin-bottom: 1em;">Will you be attending the Managers & Directors Summit?</p>

                    <div class="radio-item" onclick="selectPrimaryAttendance('yes')">
                        <input type="radio" name="primaryAttendance" id="primaryAttendYes" value="yes">
                        <label for="primaryAttendYes">Yes, I will attend</label>
                    </div>

                    <div class="radio-item" onclick="selectPrimaryAttendance('no')">
                        <input type="radio" name="primaryAttendance" id="primaryAttendNo" value="no">
                        <label for="primaryAttendNo">No, I will not attend</label>
                    </div>
                </div>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step2NextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 3a: Attendance Format (Primary Member) -->
            <div id="step3aSection" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 2 of 4</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 50%;"></div>
                    </div>
                </div>

                <h1>How Will You Attend?</h1>

                <div class="radio-group">
                    <p style="font-weight: 600; margin-bottom: 1em;">Please select your attendance format:</p>

                    <div class="radio-item" onclick="selectPrimaryFormat('in-person')">
                        <input type="radio" name="primaryFormat" id="primaryFormatInPerson" value="in-person">
                        <label for="primaryFormatInPerson">
                            In Person
                            <div class="explanation-text">I will attend the summit in person at the designated location</div>
                        </label>
                    </div>

                    <div class="radio-item" onclick="selectPrimaryFormat('virtual')">
                        <input type="radio" name="primaryFormat" id="primaryFormatVirtual" value="virtual">
                        <label for="primaryFormatVirtual">
                            Virtual (Online)
                            <div class="explanation-text">I will attend the summit remotely via video conference</div>
                        </label>
                    </div>
                </div>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step3aNextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 3b: Traffic Light Protocol -->
            <div id="step3bSection" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 2 of 4 - Traffic Light Protocol Red</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 50%;"></div>
                    </div>
                </div>

                <h1>Traffic Light Protocol Red</h1>

                <div class="scroll-to-accept-container" id="tlpRedScrollContainer">
                    <div class="agreement-content">
                        <h3>Before you register, you need to understand what you're agreeing to.</h3>

                        <p>This summit operates under <strong>"Traffic Light Protocol Red"</strong> - the highest level of confidentiality. Everything discussed in this meeting stays in the room where it's discussed. No exceptions.</p>

                        <h3>What We'll Be Discussing</h3>
                        <p>Frank conversations about:</p>
                        <ul>
                            <li>The real financial situation of your campus store</li>
                            <li>Staffing levels, changes, and expertise needs</li>
                            <li>Operational challenges and solutions</li>
                            <li>Strategic decisions your institution is requiring</li>
                        </ul>

                        <h3>Who Can Attend</h3>
                        <p>This meeting is designed for management-level staff who can speak candidly about their store's operations and strategic decisions.</p>

                        <p><strong>If you are the primary CSC member:</strong> You can attend yourself or designate someone else from your team.</p>

                        <p><strong>If you are designating someone else:</strong> You are personally responsible for ensuring they understand and will follow these rules. The CSC Board reserves the right to exclude any designee if they believe that person cannot contribute meaningfully to the conversation.</p>

                        <h3>The Rules</h3>
                        <p><strong>In-Person:</strong> "What's said in the room stays in the room. No recording of any kind. No sharing notes or information afterward."</p>

                        <p><strong>Virtual:</strong> You must be alone, camera on, microphone available and tested prior to the meeting starting, no recording, no sharing information afterward.</p>

                        <h3>Consequences</h3>
                        <p>Breaking confidentiality may result in immediate membership termination with no appeals or refunds.</p>
                    </div>
                    <div class="scroll-indicator" id="tlpRedScrollIndicator">
                        ↓ Scroll down to continue ↓
                    </div>
                </div>

                <button class="sign-agreement-btn" id="tlpRedSignBtn" onclick="openTLPRedSignatureModal()" disabled>
                    <span id="tlpRedSignBtnText">Please scroll to the bottom to sign</span>
                </button>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step3bNextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 3bv: Virtual Protocol (Only for Virtual Attendees) -->
            <div id="step3bvSection" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 2 of 4 - Virtual Attendance Protocol</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 50%;"></div>
                    </div>
                </div>

                <h1>Virtual Attendance Protocol</h1>

                <div class="scroll-to-accept-container" id="virtualProtocolScrollContainer">
                    <div class="agreement-content">
                        <div class="summit-warning" style="margin-top: 0;">
                            <p><strong>CRITICAL:</strong> Virtual attendance requires strict compliance with the following rules. Failure to follow these rules will result in immediate removal from the meeting and potential membership termination.</p>
                        </div>

                        <h3>Mandatory Virtual Attendance Requirements</h3>

                        <p><strong>1. Solo Environment - You Must Be Completely Alone:</strong></p>
                        <ul>
                            <li>You must be in a private room with a <strong>locked door</strong></li>
                            <li>No other person may be present in the room at any time</li>
                            <li>No one may overhear or view any part of the meeting</li>
                        </ul>

                        <p><strong>2. Camera On - Visual Verification Required:</strong></p>
                        <ul>
                            <li>Your camera must be <strong>on and facing you</strong> for the entire meeting</li>
                            <li>You must be clearly visible at all times</li>
                            <li>No virtual backgrounds</li>
                        </ul>

                        <p><strong>3. Microphone Available - Audio Verification Required:</strong></p>
                        <ul>
                            <li>Your microphone must be <strong>available and tested</strong> prior to the meeting starting</li>
                            <li>We need to verify your audio is working properly</li>
                            <li>Follow host instructions regarding muting during the meeting</li>
                        </ul>

                        <p><strong>4. Immediate Drop-Out Rule - Zero Tolerance:</strong></p>
                        <ul>
                            <li>If <strong>anyone enters your room</strong> for any reason, you must <strong>IMMEDIATELY DROP OUT</strong> of the call</li>
                            <li>Do NOT mute - you must <strong>LEAVE THE MEETING</strong> entirely</li>
                            <li>You may not return until the intruder has left and your space is secure</li>
                            <li>Examples: delivery person, family member, pet, cleaning staff, maintenance - ANYONE</li>
                        </ul>

                        <p><strong>5. No Recording:</strong></p>
                        <ul>
                            <li>Absolutely no audio or video recording of any kind</li>
                            <li>No screenshots or screen recording</li>
                            <li>Notes must be personal, accounted for, and disposed of appropriately if they contain sensitive materials</li>
                            <li>Close all other applications except the video conference</li>
                        </ul>

                        <h3>Consequences</h3>
                        <p>Violation of any virtual protocol rule may result in:</p>
                        <ul>
                            <li>Immediate removal from the current meeting</li>
                            <li>Possible termination of CSC membership</li>
                            <li>No refunds or appeals</li>
                        </ul>
                    </div>
                    <div class="scroll-indicator" id="virtualProtocolScrollIndicator">
                        ↓ Scroll down to continue ↓
                    </div>
                </div>

                <button class="sign-agreement-btn" id="virtualProtocolSignBtn" onclick="openVirtualProtocolSignatureModal()" disabled>
                    <span id="virtualProtocolSignBtnText">Please scroll to the bottom to sign</span>
                </button>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step3bvNextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 3c: Employment Contracts -->
            <div id="step3cSection" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 2 of 4 - Employment Contracts</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 50%;"></div>
                    </div>
                </div>

                <h1>Employment Contract Review</h1>

                <div class="agreement-content">
                    <p>If you or your designee are covered by a collective bargaining agreement, you must review your contract to ensure there are no provisions that would require you to disclose information from this meeting.</p>

                    <p>By registering, you assume full responsibility for any conflicts between this confidentiality agreement and your employment contract.</p>
                </div>

                <button class="sign-agreement-btn" id="employmentSignBtn" onclick="openEmploymentSignatureModal()">
                    <span id="employmentSignBtnText">Sign to Acknowledge Responsibility</span>
                </button>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step3cNextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 4: Designate Alternate -->
            <div id="step4Section" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 3 of 4</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%;"></div>
                    </div>
                </div>

                <h1>Designate an Alternate</h1>

                <div class="summit-warning">
                    <h3 style="margin-top: 0;">Critical: Your Responsibility</h3>
                    <p><strong>If you designate an alternate, you are personally responsible for their conduct—whether you attend or not.</strong></p>

                    <p>Your designee must be someone who:</p>
                    <ul>
                        <li><strong>Is of appropriate level</strong> to meaningfully contribute to the conversation</li>
                        <li><strong>Is NOT attending just because you're traveling together</strong></li>
                        <li><strong>Can share information independently</strong> without having to clear things with you or their collective bargaining agreement</li>
                    </ul>

                    <p style="margin-bottom: 0;">This is not a casual invitation—your alternate must be able to participate fully and independently in sensitive, strategic discussions.</p>
                </div>

                <div class="radio-group">
                    <p style="font-weight: 600; margin-bottom: 1em;">Would you like to designate an alternate?</p>

                    <div class="radio-item" onclick="selectDesignateAlternate('yes')">
                        <input type="radio" name="designateAlternate" id="designateYes" value="yes">
                        <label for="designateYes">Yes, I would like to designate an alternate</label>
                    </div>

                    <div class="radio-item" onclick="selectDesignateAlternate('no')">
                        <input type="radio" name="designateAlternate" id="designateNo" value="no">
                        <label for="designateNo">No, there will not be an alternate</label>
                    </div>
                </div>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step4NextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 5: Alternate Selection -->
            <div id="step5Section" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 3 of 4 - Select Alternate</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%;"></div>
                    </div>
                </div>

                <h1>Select Your Alternate</h1>

                <div class="summit-info">
                    <p>Choose who you would like to designate as your alternate from your team:</p>
                </div>

                <div class="team-container">
                    <div class="team-list-wrapper">
                        <div class="team-list" id="alternateList">
                            <!-- Contacts will be dynamically added here -->
                        </div>
                        <div class="team-list-fade"></div>
                        <div class="team-list-shadow"></div>
                        <div class="custom-scrollbar" id="alternateScrollbar">
                            <div class="scrollbar-track">
                                <div class="scrollbar-thumb" id="alternateScrollbarThumb"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step5NextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 6: Alternate Attendance Format -->
            <div id="step6Section" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 3 of 4 - Alternate Format</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%;"></div>
                    </div>
                </div>

                <h1>Alternate Attendance Format</h1>

                <div class="radio-group">
                    <p style="font-weight: 600; margin-bottom: 1em;">How will <span id="alternateNameDisplay"></span> attend?</p>

                    <div class="radio-item" onclick="selectAlternateFormat('in-person')">
                        <input type="radio" name="alternateFormat" id="alternateFormatInPerson" value="in-person">
                        <label for="alternateFormatInPerson">
                            In Person
                            <div class="explanation-text">They will attend the summit in person at the designated location</div>
                        </label>
                    </div>

                    <div class="radio-item" onclick="selectAlternateFormat('virtual')">
                        <input type="radio" name="alternateFormat" id="alternateFormatVirtual" value="virtual">
                        <label for="alternateFormatVirtual">
                            Virtual (Online)
                            <div class="explanation-text">They will attend the summit remotely via video conference</div>
                        </label>
                    </div>
                </div>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step6NextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 7: Primary Member Certification for Alternate -->
            <div id="step7Section" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Step 3 of 4 - Certification</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%;"></div>
                    </div>
                </div>

                <h1>Primary Member Certification</h1>

                <div class="scroll-to-accept-container" id="certificationScrollContainer">
                    <div class="agreement-content">
                        <div class="summit-warning" style="margin-top: 0;">
                            <p><strong>By designating <span id="certificationAlternateName"></span>, you certify the following:</strong></p>
                        </div>

                        <h3>Certification of Alternate Designee</h3>

                        <p><strong>1. Confidentiality Understanding:</strong></p>
                        <p>I certify that <span id="certificationAlternateName2"></span> fully understands the Traffic Light Protocol Red confidentiality requirements and will uphold them without exception.</p>

                        <p><strong>2. Personal Responsibility:</strong></p>
                        <p>I understand that I am personally responsible for the conduct of my designee, whether I attend the summit or not. Any breach of confidentiality by my designee will be treated as if I committed the breach myself.</p>

                        <p><strong>3. Appropriate Level:</strong></p>
                        <p>I certify that my designee is of appropriate management level to meaningfully contribute to strategic discussions about campus store operations, finances, and challenges.</p>

                        <p><strong>4. Independent Participation:</strong></p>
                        <p>I certify that my designee can share information and participate in discussions independently, without needing to clear things with me or their collective bargaining agreement.</p>

                        <p><strong>5. Board Discretion:</strong></p>
                        <p>I understand and accept that the CSC Board reserves the right to exclude my designee if they determine that person cannot meaningfully contribute to the conversation.</p>

                        <p><strong>6. No Refunds or Appeals:</strong></p>
                        <p>I understand that if my designee is excluded for any reason, or if either of us breaches confidentiality, there will be no refunds and no appeals process.</p>

                        <div class="summit-info" style="margin-top: 2em;">
                            <p><strong>Next Step:</strong> After you sign this certification, <span id="emailAlternateName"></span> will receive an email with a unique link to complete their own confidentiality agreement.</p>
                        </div>
                    </div>
                    <div class="scroll-indicator" id="certificationScrollIndicator">
                        ↓ Scroll down to continue ↓
                    </div>
                </div>

                <button class="sign-agreement-btn" id="certificationSignBtn" onclick="openCertificationSignatureModal()" disabled>
                    <span id="certificationSignBtnText">Please scroll to the bottom to sign</span>
                </button>

                <button class="previous-btn" onclick="previousStep()">
                    <span>←</span>
                    Previous step
                </button>
                <button class="next-btn" id="step7NextBtn" onclick="nextStep()" disabled>
                    Next step
                    <span>→</span>
                </button>
            </div>

            <!-- Step 8: Confirmation -->
            <div id="step8Section" class="content-section">
                <div class="progress-indicator">
                    <div class="progress-text">Complete!</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%;"></div>
                    </div>
                </div>

                <h1>Registration Confirmed</h1>

                <div class="summit-info" id="confirmationMessage">
                    <!-- Dynamic confirmation message will be inserted here -->
                </div>

                <div class="summit-warning" id="nextStepsMessage">
                    <!-- Dynamic next steps message will be inserted here -->
                </div>

                <div style="margin-top: 3em; text-align: center;">
                    <p style="color: #6c757d;">If you have any questions, please contact <a href="mailto:info@campusstores.ca">info@campusstores.ca</a></p>
                </div>
            </div>

            </div><!-- /main-content -->
        </div><!-- /wizard-content -->
    </div><!-- /wizard-container -->

    <!-- JavaScript -->
    <script>
        // Global State
        let currentStep = 0;
        let token = '';
        let isDesignee = false;
        let registrationId = null;
        let organizationData = {};
        let organizationContacts = [];

        // Primary Member State
        let primaryMemberContact = null;
        let primaryMemberEdits = {
            name: null,
            title: null,
            email: null,
            phone: null
        };

        // Registration State
        let registrationState = {
            // Identity
            isPrimaryMember: null,

            // Primary Member
            primaryIsAttending: null,
            primaryFormat: null,
            tlpRedSignatureUrl: null,
            employmentSignatureUrl: null,
            virtualProtocolSignatureUrl: null,
            primaryVirtualAgreed: false,
            primaryBreachAck: false,

            // Designee
            hasDesignee: null,
            designeeContact: null,
            designeeIsNew: false,
            designeeFormat: null,

            // Certification
            certificationChecks: [],
            certificationFile: null,
            certificationUrl: null
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            // Get token from URL
            const urlParams = new URLSearchParams(window.location.search);
            token = urlParams.get('token');

            if (!token) {
                hideLoading();
                alert('No token provided. Please use the link from your email.');
                return;
            }

            // Load organization data and primary member info on page load
            await loadOrganizationData();

            // Initialize signature canvases
            initSignaturePads();

            // Initialize scroll-to-accept for TLP Red, Virtual Protocol, and Certification pages
            initTLPRedScrollDetection();
            initVirtualProtocolScrollDetection();
            initCertificationScrollDetection();
        });

        async function loadOrganizationData() {
            try {
                // Detect if this is a designee token
                isDesignee = token.startsWith('designee-');

                let data;
                if (isDesignee) {
                    // Load designee registration data
                    console.log('🔍 Loading designee registration...');
                    const response = await fetch(`/api/get-designee-registration?token=${token}`);
                    data = await response.json();

                    if (data.error) {
                        alert(data.error || 'Invalid designee token or registration not found.');
                        return;
                    }

                    registrationId = data.registrationId;
                    organizationData = data;

                    // Set primary member contact to the designee's info
                    // Map API field names to expected field names
                    primaryMemberContact = {
                        id: data.contact?.id,
                        name: data.contact?.name,
                        firstName: data.contact?.firstName,
                        roleTitle: data.contact?.title,
                        workEmail: data.contact?.email,
                        workPhone: data.contact?.phone
                    };

                    // Pre-select their attendance format
                    registrationState.primaryFormat = data.attendanceFormat;
                    registrationState.primaryIsAttending = true;

                    console.log('✅ Loaded designee data:', primaryMemberContact?.name);
                } else {
                    // Load organization data (primary member flow)
                    const response = await fetch(`/api/get-organization?token=${token}`);
                    data = await response.json();

                    if (data.error) {
                        alert('Invalid token or organization not found.');
                        return;
                    }

                    organizationData = data;

                    // Load contacts and filter for primary member
                    const contactsResponse = await fetch(`/api/get-organization-contacts?token=${token}`);
                    const contactsData = await contactsResponse.json();
                    organizationContacts = contactsData.contacts || [];

                    // Find the primary contact (primary member)
                    primaryMemberContact = organizationContacts.find(contact => contact.isPrimaryContact);

                    if (primaryMemberContact) {
                        console.log('✅ Found primary member:', primaryMemberContact.name);
                    } else {
                        console.warn('⚠️ No primary member found in contacts');
                    }
                }

                // Populate organization logo/name in sidebar
                const organizationLogoContainer = document.getElementById('organizationLogo');
                if (data.organization?.logo && !data.organization.logo.includes('${')) {
                    organizationLogoContainer.innerHTML = `<img src="${data.organization.logo}" alt="${data.organization.name || 'Organization'} Logo" class="organization-logo">`;
                } else if (data.organization?.name) {
                    organizationLogoContainer.innerHTML = `<div class="organization-name">${data.organization.name}</div>`;
                }

                // Display member info
                if (primaryMemberContact) {
                    displayPrimaryMember();
                }

                hideLoading();
            } catch (error) {
                console.error('Error loading data:', error);
                hideLoading();
                alert('Error loading organization data. Please try again.');
            }
        }

        function hideLoading() {
            document.getElementById('loadingState').classList.remove('active');
            document.querySelector('.wizard-content').classList.add('loaded');
        }

        function showLoading() {
            document.getElementById('loadingState').classList.add('active');
        }

        // ========================================
        // Primary Member Functions
        // ========================================

        // Display primary member in the card
        function displayPrimaryMember() {
            if (!primaryMemberContact) return;

            // Get current data (edits override original)
            const currentData = {
                name: primaryMemberEdits.name || primaryMemberContact.name,
                title: primaryMemberEdits.title || primaryMemberContact.roleTitle,
                email: primaryMemberEdits.email || primaryMemberContact.workEmail,
                phone: primaryMemberEdits.phone || primaryMemberContact.workPhone
            };

            // Update display
            document.getElementById('pmDisplayName').textContent = currentData.name || 'Unknown Name';
            document.getElementById('pmDisplayTitle').textContent = currentData.title || 'No title provided';
            document.getElementById('pmDisplayEmail').textContent = currentData.email || 'No email provided';
            document.getElementById('pmDisplayPhone').textContent = formatPhoneForDisplay(currentData.phone) || 'No phone provided';

            // Show the section
            document.getElementById('primaryMemberSection').style.display = 'block';
        }

        // Format phone number for display: (XXX) XXX-XXXX
        function formatPhoneForDisplay(phone) {
            if (!phone) return '';

            // Remove all non-digit characters
            const digits = phone.replace(/\D/g, '');

            // Format based on length
            if (digits.length === 10) {
                return `(${digits.substring(0, 3)}) ${digits.substring(3, 6)}-${digits.substring(6)}`;
            } else if (digits.length === 11 && digits[0] === '1') {
                return `+1 (${digits.substring(1, 4)}) ${digits.substring(4, 7)}-${digits.substring(7)}`;
            }

            // Return as-is if it doesn't match expected format
            return phone;
        }

        // Format phone number as user types
        function formatPhoneInput(input) {
            // Remove all non-digit characters
            let value = input.value.replace(/\D/g, '');

            // Limit to 10 digits
            value = value.substring(0, 10);

            // Format progressively
            let formatted = '';
            if (value.length > 0) {
                formatted = '(' + value.substring(0, 3);
            }
            if (value.length >= 4) {
                formatted += ') ' + value.substring(3, 6);
            }
            if (value.length >= 7) {
                formatted += '-' + value.substring(6, 10);
            }

            input.value = formatted;
        }

        // Open primary member edit modal
        function openPrimaryMemberModal() {
            if (!primaryMemberContact) return;

            // Populate modal with current data (edits or original)
            document.getElementById('pmName').value = primaryMemberEdits.name || primaryMemberContact.name || '';
            document.getElementById('pmTitle').value = primaryMemberEdits.title || primaryMemberContact.roleTitle || '';
            document.getElementById('pmEmail').value = primaryMemberEdits.email || primaryMemberContact.workEmail || '';

            const currentPhone = primaryMemberEdits.phone || primaryMemberContact.workPhone || '';
            document.getElementById('pmPhone').value = formatPhoneForDisplay(currentPhone);

            // Clear any previous error states
            clearModalErrors();

            // Add phone formatting listener
            const phoneInput = document.getElementById('pmPhone');
            phoneInput.addEventListener('input', function() {
                formatPhoneInput(this);
            });

            // Show modal
            document.getElementById('primaryMemberModal').classList.add('active');
        }

        // Close primary member edit modal
        function closePrimaryMemberModal() {
            document.getElementById('primaryMemberModal').classList.remove('active');
            clearModalErrors();
        }

        // Clear modal error messages
        function clearModalErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.classList.remove('visible');
            });
            document.querySelectorAll('.modal-field input').forEach(el => {
                el.classList.remove('error');
            });
        }

        // Validate email format
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Validate phone format (must be 10 digits)
        function isValidPhone(phone) {
            const digits = phone.replace(/\D/g, '');
            return digits.length === 10;
        }

        // Save primary member details
        async function savePrimaryMemberDetails() {
            // Get values
            const name = document.getElementById('pmName').value.trim();
            const title = document.getElementById('pmTitle').value.trim();
            const email = document.getElementById('pmEmail').value.trim();
            const phone = document.getElementById('pmPhone').value.trim();

            // Clear previous errors
            clearModalErrors();

            // Validate all fields
            let hasError = false;

            if (!name) {
                document.getElementById('pmName').classList.add('error');
                document.getElementById('pmNameError').classList.add('visible');
                hasError = true;
            }

            if (!title) {
                document.getElementById('pmTitle').classList.add('error');
                document.getElementById('pmTitleError').classList.add('visible');
                hasError = true;
            }

            if (!email || !isValidEmail(email)) {
                document.getElementById('pmEmail').classList.add('error');
                document.getElementById('pmEmailError').classList.add('visible');
                hasError = true;
            }

            if (!phone || !isValidPhone(phone)) {
                document.getElementById('pmPhone').classList.add('error');
                document.getElementById('pmPhoneError').classList.add('visible');
                hasError = true;
            }

            if (hasError) {
                return; // Don't save if validation fails
            }

            // Store edits
            primaryMemberEdits.name = name;
            primaryMemberEdits.title = title;
            primaryMemberEdits.email = email;
            primaryMemberEdits.phone = phone.replace(/\D/g, ''); // Store as digits only

            // Update the display
            displayPrimaryMember();

            // Update the contact in Notion
            await updatePrimaryMemberContact();

            // Close modal
            closePrimaryMemberModal();

            console.log('✅ Primary member details saved:', primaryMemberEdits);
        }

        // Update primary member contact in Notion
        async function updatePrimaryMemberContact() {
            if (!primaryMemberContact || !primaryMemberContact.id) {
                console.error('❌ No primary member contact to update');
                return;
            }

            try {
                const response = await fetch('/api/update-contact', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contactId: primaryMemberContact.id,
                        updates: {
                            name: primaryMemberEdits.name || primaryMemberContact.name,
                            roleTitle: primaryMemberEdits.title || primaryMemberContact.roleTitle,
                            workEmail: primaryMemberEdits.email || primaryMemberContact.workEmail,
                            workPhone: primaryMemberEdits.phone || primaryMemberContact.workPhone
                        }
                    })
                });

                if (response.ok) {
                    console.log('✅ Primary member contact updated in Notion');
                } else {
                    console.error('❌ Failed to update contact in Notion');
                }
            } catch (error) {
                console.error('❌ Error updating contact:', error);
            }
        }

        // ========================================
        // End Primary Member Functions
        // ========================================

        // ========================================
        // Scroll-to-Accept for TLP Red
        // ========================================

        let tlpRedScrolledToBottom = false;
        let virtualProtocolScrolledToBottom = false;
        let certificationScrolledToBottom = false;

        function initTLPRedScrollDetection() {
            const scrollContainer = document.getElementById('tlpRedScrollContainer');
            const scrollIndicator = document.getElementById('tlpRedScrollIndicator');
            const signBtn = document.getElementById('tlpRedSignBtn');
            const signBtnText = document.getElementById('tlpRedSignBtnText');

            if (!scrollContainer) return;

            // Start pulsing the scroll container to encourage reading
            scrollContainer.classList.add('pulse');

            // Check if user has scrolled to bottom
            function checkScrollPosition() {
                const scrollTop = scrollContainer.scrollTop;
                const scrollHeight = scrollContainer.scrollHeight;
                const clientHeight = scrollContainer.clientHeight;

                console.log('Scroll check:', { scrollTop, scrollHeight, clientHeight, needsScroll: scrollHeight > clientHeight });

                // Only consider "at bottom" if:
                // 1. Content is short enough to not need scrolling (scrollHeight <= clientHeight + 10)
                //    AND content is fully loaded (scrollHeight > 100)
                // 2. OR user has actually scrolled near the bottom
                const contentIsShort = scrollHeight <= clientHeight + 10 && scrollHeight > 100;
                const scrolledToBottom = scrollTop + clientHeight >= scrollHeight - 5 && scrollTop > 0;
                const isAtBottom = contentIsShort || scrolledToBottom;

                if (isAtBottom && !tlpRedScrolledToBottom) {
                    tlpRedScrolledToBottom = true;

                    // Stop pulsing scroll container
                    scrollContainer.classList.remove('pulse');

                    // Hide scroll indicator
                    scrollIndicator.classList.add('hidden');

                    // Enable sign button
                    signBtn.disabled = false;
                    signBtnText.textContent = 'Click to Sign Agreement';

                    // Pulse the sign button to show it's the next step
                    signBtn.classList.add('pulse');

                    // Remove pulse when they click to sign
                    signBtn.addEventListener('click', () => {
                        signBtn.classList.remove('pulse');
                    }, { once: true });

                    console.log('✅ User scrolled to bottom of TLP Red agreement');
                }
            }

            // Add scroll listener
            scrollContainer.addEventListener('scroll', checkScrollPosition);

            // Check initial position ONLY after content is fully loaded
            // Give time for DOM to fully render the content
            setTimeout(() => {
                const scrollHeight = scrollContainer.scrollHeight;
                const clientHeight = scrollContainer.clientHeight;

                // Only auto-check if content is definitely short and fully rendered
                if (scrollHeight > 100 && scrollHeight <= clientHeight + 10) {
                    console.log('Content is short, auto-enabling sign button');
                    checkScrollPosition();
                }
                // Otherwise, user MUST scroll - don't auto-enable
            }, 500);
        }

        function initVirtualProtocolScrollDetection() {
            const scrollContainer = document.getElementById('virtualProtocolScrollContainer');
            const scrollIndicator = document.getElementById('virtualProtocolScrollIndicator');
            const signBtn = document.getElementById('virtualProtocolSignBtn');
            const signBtnText = document.getElementById('virtualProtocolSignBtnText');

            if (!scrollContainer) return;

            // Start pulsing the scroll container to encourage reading
            scrollContainer.classList.add('pulse');

            // Check if user has scrolled to bottom
            function checkScrollPosition() {
                const scrollTop = scrollContainer.scrollTop;
                const scrollHeight = scrollContainer.scrollHeight;
                const clientHeight = scrollContainer.clientHeight;

                console.log('Virtual Protocol scroll check:', { scrollTop, scrollHeight, clientHeight });

                // Only consider "at bottom" if:
                // 1. Content is short enough to not need scrolling (scrollHeight <= clientHeight + 10)
                //    AND content is fully loaded (scrollHeight > 100)
                // 2. OR user has actually scrolled near the bottom
                const contentIsShort = scrollHeight <= clientHeight + 10 && scrollHeight > 100;
                const scrolledToBottom = scrollTop + clientHeight >= scrollHeight - 5 && scrollTop > 0;
                const isAtBottom = contentIsShort || scrolledToBottom;

                if (isAtBottom && !virtualProtocolScrolledToBottom) {
                    virtualProtocolScrolledToBottom = true;

                    // Stop pulsing scroll container
                    scrollContainer.classList.remove('pulse');

                    // Hide scroll indicator
                    scrollIndicator.classList.add('hidden');

                    // Enable sign button
                    signBtn.disabled = false;
                    signBtnText.textContent = 'Click to Sign Virtual Protocol';

                    // Pulse the sign button to show it's the next step
                    signBtn.classList.add('pulse');

                    // Remove pulse when they click to sign
                    signBtn.addEventListener('click', () => {
                        signBtn.classList.remove('pulse');
                    }, { once: true });

                    console.log('✅ User scrolled to bottom of Virtual Protocol agreement');
                }
            }

            // Add scroll listener
            scrollContainer.addEventListener('scroll', checkScrollPosition);

            // Check initial position ONLY after content is fully loaded
            // Give time for DOM to fully render the content
            setTimeout(() => {
                const scrollHeight = scrollContainer.scrollHeight;
                const clientHeight = scrollContainer.clientHeight;

                // Only auto-check if content is definitely short and fully rendered
                if (scrollHeight > 100 && scrollHeight <= clientHeight + 10) {
                    console.log('Virtual Protocol content is short, auto-enabling sign button');
                    checkScrollPosition();
                }
                // Otherwise, user MUST scroll - don't auto-enable
            }, 500);
        }

        function initCertificationScrollDetection() {
            const scrollContainer = document.getElementById('certificationScrollContainer');
            const scrollIndicator = document.getElementById('certificationScrollIndicator');
            const signBtn = document.getElementById('certificationSignBtn');
            const signBtnText = document.getElementById('certificationSignBtnText');

            if (!scrollContainer) return;

            // Start pulsing the scroll container to encourage reading
            scrollContainer.classList.add('pulse');

            // Check if user has scrolled to bottom
            function checkScrollPosition() {
                const scrollTop = scrollContainer.scrollTop;
                const scrollHeight = scrollContainer.scrollHeight;
                const clientHeight = scrollContainer.clientHeight;

                console.log('Certification scroll check:', { scrollTop, scrollHeight, clientHeight });

                // Only consider "at bottom" if:
                // 1. Content is short enough to not need scrolling (scrollHeight <= clientHeight + 10)
                //    AND content is fully loaded (scrollHeight > 100)
                // 2. OR user has actually scrolled near the bottom
                const contentIsShort = scrollHeight <= clientHeight + 10 && scrollHeight > 100;
                const scrolledToBottom = scrollTop + clientHeight >= scrollHeight - 5 && scrollTop > 0;
                const isAtBottom = contentIsShort || scrolledToBottom;

                if (isAtBottom && !certificationScrolledToBottom) {
                    certificationScrolledToBottom = true;

                    // Stop pulsing scroll container
                    scrollContainer.classList.remove('pulse');

                    // Hide scroll indicator
                    scrollIndicator.classList.add('hidden');

                    // Enable sign button
                    signBtn.disabled = false;
                    signBtnText.textContent = 'Click to Sign Certification';

                    // Pulse the sign button to show it's the next step
                    signBtn.classList.add('pulse');

                    // Remove pulse when they click to sign
                    signBtn.addEventListener('click', () => {
                        signBtn.classList.remove('pulse');
                    }, { once: true });

                    console.log('✅ User scrolled to bottom of Certification');
                }
            }

            // Add scroll listener
            scrollContainer.addEventListener('scroll', checkScrollPosition);

            // Check initial position ONLY after content is fully loaded
            // Give time for DOM to fully render the content
            setTimeout(() => {
                const scrollHeight = scrollContainer.scrollHeight;
                const clientHeight = scrollContainer.clientHeight;

                // Only auto-check if content is definitely short and fully rendered
                if (scrollHeight > 100 && scrollHeight <= clientHeight + 10) {
                    console.log('Certification content is short, auto-enabling sign button');
                    checkScrollPosition();
                }
                // Otherwise, user MUST scroll - don't auto-enable
            }, 500);
        }

        // ========================================
        // End Scroll-to-Accept
        // ========================================

        async function startWizard() {
            // Data is already loaded on page load, just transition to first step
            document.getElementById('welcomeSection').classList.remove('active');
            document.getElementById('step2Section').classList.add('active');
            currentStep = 1;
        }

        // Step 1: Primary Attendance
        function selectPrimaryAttendance(answer) {
            registrationState.primaryIsAttending = answer === 'yes';

            document.querySelectorAll('input[name="primaryAttendance"]').forEach(input => {
                input.parentElement.classList.remove('selected');
            });

            const selectedRadio = document.getElementById(`primaryAttend${answer === 'yes' ? 'Yes' : 'No'}`);
            selectedRadio.checked = true;
            selectedRadio.parentElement.classList.add('selected');

            document.getElementById('step2NextBtn').disabled = false;
        }

        // Step 3a: Primary Format
        function selectPrimaryFormat(format) {
            registrationState.primaryFormat = format;

            document.querySelectorAll('input[name="primaryFormat"]').forEach(input => {
                input.parentElement.classList.remove('selected');
            });

            const selectedRadio = document.getElementById(`primaryFormat${format === 'in-person' ? 'InPerson' : 'Virtual'}`);
            selectedRadio.checked = true;
            selectedRadio.parentElement.classList.add('selected');

            document.getElementById('step3aNextBtn').disabled = false;
        }

        // Signature Pads
        let tlpRedSignaturePad = null;
        let employmentSignaturePad = null;
        let virtualProtocolSignaturePad = null;
        let certificationSignaturePad = null;
        let tlpRedHasSignature = false;
        let employmentHasSignature = false;
        let virtualProtocolHasSignature = false;
        let certificationHasSignature = false;

        function initSignaturePads() {
            // Signature pads will be initialized when modals open
            console.log('✅ Signature pads ready to initialize on modal open');
        }

        // TLP Red Signature Modal Functions
        function openTLPRedSignatureModal() {
            const modal = document.getElementById('tlpRedSignatureModal');
            modal.classList.add('active');

            // Initialize signature pad if not already done
            if (!tlpRedSignaturePad) {
                const canvas = document.getElementById('tlpRedSignatureCanvas');
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = 200;

                tlpRedSignaturePad = new SignaturePad(canvas, {
                    backgroundColor: 'rgb(255, 255, 255)',
                    penColor: 'rgb(0, 0, 0)',
                    minWidth: 1,
                    maxWidth: 2.5,
                    throttle: 16,
                    velocityFilterWeight: 0.7
                });

                tlpRedSignaturePad.addEventListener('endStroke', () => {
                    document.getElementById('tlpRedSaveBtn').disabled = tlpRedSignaturePad.isEmpty();
                });

                console.log('✅ TLP Red signature pad initialized');
            }

            // If they already signed, restore it
            if (tlpRedHasSignature) {
                document.getElementById('tlpRedSaveBtn').disabled = false;
            }
        }

        function closeTLPRedSignatureModal() {
            document.getElementById('tlpRedSignatureModal').classList.remove('active');
        }

        function clearTLPRedSignature() {
            if (!tlpRedSignaturePad) return;
            tlpRedSignaturePad.clear();
            document.getElementById('tlpRedSaveBtn').disabled = true;
        }

        function saveTLPRedSignature() {
            if (!tlpRedSignaturePad || tlpRedSignaturePad.isEmpty()) return;

            tlpRedHasSignature = true;
            const btn = document.getElementById('tlpRedSignBtn');
            const btnText = document.getElementById('tlpRedSignBtnText');
            btn.classList.add('signed');
            btnText.textContent = '✓ Signed - Click to view or re-sign';

            updateStep3bState();
            closeTLPRedSignatureModal();
            console.log('✅ TLP Red signature saved');
        }

        // Employment Signature Modal Functions
        function openEmploymentSignatureModal() {
            const modal = document.getElementById('employmentSignatureModal');
            modal.classList.add('active');

            // Initialize signature pad if not already done
            if (!employmentSignaturePad) {
                const canvas = document.getElementById('employmentSignatureCanvas');
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = 200;

                employmentSignaturePad = new SignaturePad(canvas, {
                    backgroundColor: 'rgb(255, 255, 255)',
                    penColor: 'rgb(0, 0, 0)',
                    minWidth: 1,
                    maxWidth: 2.5,
                    throttle: 16,
                    velocityFilterWeight: 0.7
                });

                employmentSignaturePad.addEventListener('endStroke', () => {
                    document.getElementById('employmentSaveBtn').disabled = employmentSignaturePad.isEmpty();
                });

                console.log('✅ Employment signature pad initialized');
            }

            // If they already signed, restore it
            if (employmentHasSignature) {
                document.getElementById('employmentSaveBtn').disabled = false;
            }
        }

        function closeEmploymentSignatureModal() {
            document.getElementById('employmentSignatureModal').classList.remove('active');
        }

        function clearEmploymentSignature() {
            if (!employmentSignaturePad) return;
            employmentSignaturePad.clear();
            document.getElementById('employmentSaveBtn').disabled = true;
        }

        function saveEmploymentSignature() {
            if (!employmentSignaturePad || employmentSignaturePad.isEmpty()) return;

            employmentHasSignature = true;
            const btn = document.getElementById('employmentSignBtn');
            const btnText = document.getElementById('employmentSignBtnText');
            btn.classList.add('signed');
            btnText.textContent = '✓ Signed - Click to view or re-sign';

            updateStep3cState();
            closeEmploymentSignatureModal();
            console.log('✅ Employment signature saved');
        }

        // Virtual Protocol Signature Modal Functions
        function openVirtualProtocolSignatureModal() {
            const modal = document.getElementById('virtualProtocolSignatureModal');
            modal.classList.add('active');

            // Initialize signature pad if not already done
            if (!virtualProtocolSignaturePad) {
                const canvas = document.getElementById('virtualProtocolSignatureCanvas');
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = 200;

                virtualProtocolSignaturePad = new SignaturePad(canvas, {
                    backgroundColor: 'rgb(255, 255, 255)',
                    penColor: 'rgb(0, 0, 0)',
                    minWidth: 1,
                    maxWidth: 2.5,
                    throttle: 16,
                    velocityFilterWeight: 0.7
                });

                virtualProtocolSignaturePad.addEventListener('endStroke', () => {
                    document.getElementById('virtualProtocolSaveBtn').disabled = virtualProtocolSignaturePad.isEmpty();
                });

                console.log('✅ Virtual protocol signature pad initialized');
            }

            // If they already signed, restore it
            if (virtualProtocolHasSignature) {
                document.getElementById('virtualProtocolSaveBtn').disabled = false;
            }
        }

        function closeVirtualProtocolSignatureModal() {
            document.getElementById('virtualProtocolSignatureModal').classList.remove('active');
        }

        function clearVirtualProtocolSignature() {
            if (!virtualProtocolSignaturePad) return;
            virtualProtocolSignaturePad.clear();
            document.getElementById('virtualProtocolSaveBtn').disabled = true;
        }

        function saveVirtualProtocolSignature() {
            if (!virtualProtocolSignaturePad || virtualProtocolSignaturePad.isEmpty()) return;

            virtualProtocolHasSignature = true;
            const btn = document.getElementById('virtualProtocolSignBtn');
            const btnText = document.getElementById('virtualProtocolSignBtnText');
            btn.classList.add('signed');
            btnText.textContent = '✓ Signed - Click to view or re-sign';

            updateStep3bvState();
            closeVirtualProtocolSignatureModal();
            console.log('✅ Virtual protocol signature saved');
        }

        function updateStep3bvState() {
            document.getElementById('step3bvNextBtn').disabled = !virtualProtocolHasSignature;
        }

        // Certification Signature Modal Functions
        function openCertificationSignatureModal() {
            const modal = document.getElementById('certificationSignatureModal');
            modal.classList.add('active');

            // Initialize signature pad if not already done
            if (!certificationSignaturePad) {
                const canvas = document.getElementById('certificationSignatureCanvas');
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = 200;

                certificationSignaturePad = new SignaturePad(canvas, {
                    backgroundColor: 'rgb(255, 255, 255)',
                    penColor: 'rgb(0, 0, 0)',
                    minWidth: 1,
                    maxWidth: 2.5,
                    throttle: 16,
                    velocityFilterWeight: 0.7
                });

                certificationSignaturePad.addEventListener('endStroke', () => {
                    document.getElementById('certificationSaveBtn').disabled = certificationSignaturePad.isEmpty();
                });

                console.log('✅ Certification signature pad initialized');
            }

            // If they already signed, restore it
            if (certificationHasSignature) {
                document.getElementById('certificationSaveBtn').disabled = false;
            }
        }

        function closeCertificationSignatureModal() {
            document.getElementById('certificationSignatureModal').classList.remove('active');
        }

        function clearCertificationSignature() {
            if (!certificationSignaturePad) return;
            certificationSignaturePad.clear();
            document.getElementById('certificationSaveBtn').disabled = true;
        }

        function saveCertificationSignature() {
            if (!certificationSignaturePad || certificationSignaturePad.isEmpty()) return;

            certificationHasSignature = true;
            const btn = document.getElementById('certificationSignBtn');
            const btnText = document.getElementById('certificationSignBtnText');
            btn.classList.add('signed');
            btnText.textContent = '✓ Signed - Click to view or re-sign';

            updateStep7State();
            closeCertificationSignatureModal();
            console.log('✅ Certification signature saved');
        }

        function updateStep7State() {
            document.getElementById('step7NextBtn').disabled = !certificationHasSignature;
        }

        function updateStep3bState() {
            document.getElementById('step3bNextBtn').disabled = !tlpRedHasSignature;
        }

        function updateStep3cState() {
            document.getElementById('step3cNextBtn').disabled = !employmentHasSignature;
        }

        // Step 3c: Virtual Protocol
        function updatePrimaryVirtualState() {
            registrationState.primaryVirtualAgreed = document.getElementById('primaryVirtualAgree').checked;
            document.getElementById('step3cNextBtn').disabled = !registrationState.primaryVirtualAgreed;

            // Update checkbox styling
            const checkboxItem = document.getElementById('primaryVirtualAgree').parentElement;
            if (registrationState.primaryVirtualAgreed) {
                checkboxItem.classList.add('checked');
            } else {
                checkboxItem.classList.remove('checked');
            }
        }

        // Step 3d: Breach Acknowledgment
        function updatePrimaryBreachState() {
            registrationState.primaryBreachAck = document.getElementById('primaryBreachAck').checked;
            document.getElementById('step3dNextBtn').disabled = !registrationState.primaryBreachAck;

            // Update checkbox styling
            const checkboxItem = document.getElementById('primaryBreachAck').parentElement;
            if (registrationState.primaryBreachAck) {
                checkboxItem.classList.add('checked');
            } else {
                checkboxItem.classList.remove('checked');
            }
        }

        // Step 4: Designate Alternate
        function initializeStep4() {
            // Step 4 now has static content - no dynamic initialization needed
            console.log('✅ Step 4 initialized');
        }

        function selectDesignateAlternate(answer) {
            registrationState.hasDesignee = answer === 'yes';

            document.querySelectorAll('input[name="designateAlternate"]').forEach(input => {
                input.parentElement.classList.remove('selected');
            });

            const selectedRadio = document.getElementById(`designate${answer === 'yes' ? 'Yes' : 'No'}`);
            selectedRadio.checked = true;
            selectedRadio.parentElement.classList.add('selected');

            document.getElementById('step4NextBtn').disabled = false;
        }

        // Step 5: Alternate Selection
        function initializeStep5() {
            console.log('✅ Initializing Step 5 - Alternate Selection');
            console.log('📋 Total contacts loaded:', organizationContacts.length);

            populateAlternateList();
            setupAlternateScrollbar();
        }

        function populateAlternateList() {
            const alternateList = document.getElementById('alternateList');
            if (!alternateList) return;

            // Clear existing content
            alternateList.innerHTML = '';

            // Filter out the primary member - they can't be their own alternate
            const availableContacts = organizationContacts.filter(contact =>
                !contact.isPrimaryContact && contact.id !== primaryMemberContact?.id
            );

            console.log('👥 Available contacts for selection:', availableContacts.length);

            if (availableContacts.length === 0) {
                alternateList.innerHTML = '<p style="color: #666; font-style: italic; padding: 1vw;">No other contacts available.</p>';
                return;
            }

            // Add each contact
            availableContacts.forEach((contact, index) => {
                const contactDiv = createAlternateContactElement(contact, index);
                alternateList.appendChild(contactDiv);
            });

            // Update scrollbar after adding contacts
            setTimeout(() => {
                updateAlternateScrollbar();
            }, 100);

            console.log(`👥 Populated ${availableContacts.length} contacts`);
        }

        function createAlternateContactElement(contact, index) {
            const contactDiv = document.createElement('div');
            contactDiv.className = 'contact-item';
            contactDiv.dataset.contactId = contact.id;
            contactDiv.dataset.index = index;

            // Format phone number for display
            const phone = contact.workPhone || '';
            const formattedPhone = phone ? formatPhoneForDisplay(phone) : '';

            // Get dietary restrictions from Notion contact data
            const dietaryRestrictions = contact.dietaryRestrictions || 'Dietary Restrictions Unknown';

            const isSelected = registrationState.designeeContact?.id === contact.id;

            contactDiv.innerHTML = `
                <div class="designate-button-wrapper" onclick="selectAlternateContact('${contact.id}'); event.stopPropagation();" title="Click to designate as alternate">
                    <button class="designate-btn ${isSelected ? 'designated' : ''}">
                        ${isSelected ? '✓ Designated' : 'Designate'}
                    </button>
                </div>
                <div class="contact-info">
                    <div class="contact-name">${contact.name}</div>
                    <div class="contact-title">${contact.roleTitle || ''}</div>
                    <div class="contact-email">${contact.workEmail || ''}</div>
                    <div class="contact-phone">${formattedPhone}</div>
                    <div class="contact-dietary">${dietaryRestrictions}</div>
                </div>
            `;

            return contactDiv;
        }

        function selectAlternateContact(contactId) {
            const contact = organizationContacts.find(c => c.id === contactId);
            if (!contact) return;

            registrationState.designeeContact = contact;
            registrationState.designeeIsNew = false;

            // Update all buttons
            document.querySelectorAll('.designate-btn').forEach(btn => {
                btn.classList.remove('designated');
                btn.textContent = 'Designate';
            });

            // Highlight selected
            const selectedBtn = document.querySelector(`[data-contact-id="${contactId}"] .designate-btn`);
            if (selectedBtn) {
                selectedBtn.classList.add('designated');
                selectedBtn.textContent = '✓ Designated';
            }

            // Enable next button
            document.getElementById('step5NextBtn').disabled = false;

            console.log(`✅ Designated ${contact.name} as alternate`);
        }

        function formatPhoneForDisplay(phone) {
            if (!phone) return '';

            // Remove all non-digit characters
            const digits = phone.replace(/\D/g, '');

            // Format as (XXX) XXX-XXXX if 10 digits, otherwise return as-is
            if (digits.length === 10) {
                return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
            }
            return phone;
        }

        function setupAlternateScrollbar() {
            const alternateList = document.getElementById('alternateList');
            const scrollbar = document.getElementById('alternateScrollbar');
            const scrollbarThumb = document.getElementById('alternateScrollbarThumb');

            if (!alternateList || !scrollbar || !scrollbarThumb) return;

            function updateScrollbarVisibility() {
                const scrollHeight = alternateList.scrollHeight;
                const clientHeight = alternateList.clientHeight;

                if (scrollHeight <= clientHeight) {
                    scrollbar.style.display = 'none';
                    return false;
                } else {
                    scrollbar.style.display = 'block';
                    return true;
                }
            }

            function updateAlternateScrollbarFunc() {
                const scrollHeight = alternateList.scrollHeight;
                const clientHeight = alternateList.clientHeight;

                if (!updateScrollbarVisibility()) {
                    return;
                }

                // Calculate thumb height as proportion of visible area
                const thumbHeight = (clientHeight / scrollHeight) * clientHeight;
                scrollbarThumb.style.height = thumbHeight + 'px';

                // Calculate thumb position
                const scrollTop = alternateList.scrollTop;
                const maxScroll = scrollHeight - clientHeight;
                const thumbMaxTop = clientHeight - thumbHeight;
                const thumbTop = maxScroll > 0 ? (scrollTop / maxScroll) * thumbMaxTop : 0;

                scrollbarThumb.style.top = thumbTop + 'px';
            }

            // Set up event listeners
            alternateList.addEventListener('scroll', updateAlternateScrollbarFunc);
            window.addEventListener('resize', updateAlternateScrollbarFunc);

            // Dragging scrollbar thumb
            let isDragging = false;
            let startY = 0;
            let startScrollTop = 0;

            scrollbarThumb.addEventListener('mousedown', (e) => {
                isDragging = true;
                startY = e.clientY;
                startScrollTop = alternateList.scrollTop;
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const deltaY = e.clientY - startY;
                const scrollHeight = alternateList.scrollHeight;
                const clientHeight = alternateList.clientHeight;
                const thumbHeight = scrollbarThumb.offsetHeight;
                const thumbMaxTop = clientHeight - thumbHeight;

                const scrollRatio = deltaY / thumbMaxTop;
                const scrollAmount = scrollRatio * (scrollHeight - clientHeight);

                alternateList.scrollTop = startScrollTop + scrollAmount;
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            // Initial update
            updateAlternateScrollbarFunc();
        }

        function updateAlternateScrollbar() {
            const alternateList = document.getElementById('alternateList');
            const scrollbar = document.getElementById('alternateScrollbar');
            const scrollbarThumb = document.getElementById('alternateScrollbarThumb');

            if (!alternateList || !scrollbar || !scrollbarThumb) return;

            const scrollHeight = alternateList.scrollHeight;
            const clientHeight = alternateList.clientHeight;

            if (scrollHeight <= clientHeight) {
                scrollbar.style.display = 'none';
                return;
            }

            scrollbar.style.display = 'block';

            const thumbHeight = (clientHeight / scrollHeight) * clientHeight;
            scrollbarThumb.style.height = thumbHeight + 'px';

            const scrollTop = alternateList.scrollTop;
            const maxScroll = scrollHeight - clientHeight;
            const thumbMaxTop = clientHeight - thumbHeight;
            const thumbTop = maxScroll > 0 ? (scrollTop / maxScroll) * thumbMaxTop : 0;

            scrollbarThumb.style.top = thumbTop + 'px';
        }

        function selectExistingContact(contact) {
            registrationState.designeeContact = contact;
            registrationState.designeeIsNew = false;

            document.querySelectorAll('.contact-card').forEach(card => {
                card.classList.remove('selected');
            });

            event.currentTarget.classList.add('selected');
            event.currentTarget.querySelector('input[type="radio"]').checked = true;

            document.getElementById('step5NextBtn').disabled = false;
        }

        function toggleNewPersonForm() {
            const form = document.getElementById('newPersonForm');
            const isVisible = form.style.display !== 'none';

            if (isVisible) {
                form.style.display = 'none';
            } else {
                form.style.display = 'block';
                // Deselect existing contacts
                document.querySelectorAll('.contact-card').forEach(card => {
                    card.classList.remove('selected');
                    card.querySelector('input[type="radio"]').checked = false;
                });
                registrationState.designeeIsNew = true;
                validateNewPersonForm();
            }
        }

        function validateNewPersonForm() {
            const name = document.getElementById('alternateName').value.trim();
            const title = document.getElementById('alternateTitle').value.trim();
            const email = document.getElementById('alternateEmail').value.trim();
            const phone = document.getElementById('alternatePhone').value.trim();

            const isValid = name && title && email && phone && email.includes('@');

            if (isValid) {
                registrationState.designeeContact = { name, title, email, phone, isNew: true };
                document.getElementById('step5NextBtn').disabled = false;
            } else {
                document.getElementById('step5NextBtn').disabled = true;
            }
        }

        // Add input listeners for new person form
        document.addEventListener('DOMContentLoaded', () => {
            ['alternateName', 'alternateTitle', 'alternateEmail', 'alternatePhone'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', validateNewPersonForm);
                }
            });
        });

        // Step 6: Alternate Format
        function initializeStep6() {
            const name = registrationState.designeeContact.name || 'your alternate';
            document.getElementById('alternateNameDisplay').textContent = name;
        }

        function selectAlternateFormat(format) {
            registrationState.designeeFormat = format;

            document.querySelectorAll('input[name="alternateFormat"]').forEach(input => {
                input.parentElement.classList.remove('selected');
            });

            const selectedRadio = document.getElementById(`alternateFormat${format === 'in-person' ? 'InPerson' : 'Virtual'}`);
            selectedRadio.checked = true;
            selectedRadio.parentElement.classList.add('selected');

            document.getElementById('step6NextBtn').disabled = false;
        }

        // Step 7: Certification
        function initializeStep7() {
            const name = registrationState.designeeContact.name || 'your alternate';
            document.getElementById('certificationAlternateName').textContent = name;
            document.getElementById('certificationAlternateName2').textContent = name;
            document.getElementById('emailAlternateName').textContent = name;
        }

        async function handleCertificationUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB');
                event.target.value = '';
                return;
            }

            registrationState.certificationFile = file;

            // Show file name
            document.getElementById('certificationFileName').textContent = `✓ ${file.name}`;
            document.getElementById('certificationFileName').style.display = 'block';
            document.getElementById('certificationUploadArea').classList.add('has-file');

            updateCertificationState();
        }

        // Step 8: Confirmation
        function initializeStep8() {
            let message = '';
            let nextSteps = '';

            if (registrationState.primaryIsAttending && registrationState.hasDesignee) {
                // Both attending
                message = `
                    <p><strong>Registration confirmed for both you and ${registrationState.designeeContact.name}.</strong></p>
                    <p>Both of you will attend the Managers & Directors Summit.</p>
                    <ul>
                        <li><strong>Your attendance:</strong> ${registrationState.primaryFormat === 'in-person' ? 'In-Person' : 'Virtual'}</li>
                        <li><strong>${registrationState.designeeContact.name}'s attendance:</strong> ${registrationState.designeeFormat === 'in-person' ? 'In-Person' : 'Virtual'}</li>
                    </ul>
                `;
                nextSteps = `
                    <p><strong>Next Steps:</strong></p>
                    <ul>
                        <li>${registrationState.designeeContact.name} will receive an email with a unique link to complete their confidentiality agreement</li>
                        <li>You will both receive confirmation emails with meeting details</li>
                        <li>Calendar invitations will be sent closer to the event date</li>
                    </ul>
                `;
            } else if (registrationState.primaryIsAttending && !registrationState.hasDesignee) {
                // Primary only
                message = `
                    <p><strong>Registration confirmed!</strong></p>
                    <p>You will attend the Managers & Directors Summit ${registrationState.primaryFormat === 'in-person' ? 'in person' : 'virtually'}.</p>
                `;
                nextSteps = `
                    <p><strong>Next Steps:</strong></p>
                    <ul>
                        <li>You will receive a confirmation email with meeting details</li>
                        <li>A calendar invitation will be sent closer to the event date</li>
                        ${registrationState.primaryFormat === 'virtual' ? '<li>Virtual attendance link and technical setup instructions will be provided</li>' : ''}
                    </ul>
                `;
            } else if (!registrationState.primaryIsAttending && registrationState.hasDesignee) {
                // Designee only
                message = `
                    <p><strong>Registration confirmed for ${registrationState.designeeContact.name}.</strong></p>
                    <p>They will attend the Managers & Directors Summit ${registrationState.designeeFormat === 'in-person' ? 'in person' : 'virtually'} on behalf of your institution.</p>
                `;
                nextSteps = `
                    <p><strong>Next Steps:</strong></p>
                    <ul>
                        <li>${registrationState.designeeContact.name} will receive an email with a unique link to complete their confidentiality agreement</li>
                        <li>Once they complete their agreement, both you and they will receive confirmation</li>
                        <li>They will receive all meeting details and calendar invitations</li>
                    </ul>
                `;
            } else {
                // No one attending
                message = `
                    <p><strong>Thank you for your response.</strong></p>
                    <p>Your institution will not have a representative at this year's Managers & Directors Summit.</p>
                `;
                nextSteps = `
                    <p>If you change your mind, please contact <a href="mailto:info@campusstores.ca">info@campusstores.ca</a></p>
                `;
            }

            document.getElementById('confirmationMessage').innerHTML = message;
            document.getElementById('nextStepsMessage').innerHTML = nextSteps;
        }

        // Helper function to map section IDs to step numbers
        function getSidebarStepNumber(sectionId) {
            // Map section IDs to sidebar step numbers
            if (sectionId === 'step1Section' || sectionId === 'step2Section') return 1;
            if (sectionId.startsWith('step3')) return 2; // step3aSection, step3bSection, step3bvSection, step3cSection
            if (sectionId === 'step4Section') return 3;
            if (sectionId === 'step5Section' || sectionId === 'step6Section' || sectionId === 'step7Section') return 4;
            return null;
        }

        // Update sidebar navigation
        function updateSidebarNavigation(currentSectionId, nextSectionId) {
            const currentStep = getSidebarStepNumber(currentSectionId);
            const nextStep = getSidebarStepNumber(nextSectionId);

            // Mark current step as completed
            if (currentStep) {
                const currentStepIndicator = document.querySelector(`.step-indicator[data-step="${currentStep}"]`);
                if (currentStepIndicator) {
                    currentStepIndicator.classList.remove('active');
                    currentStepIndicator.classList.add('completed');
                }
            }

            // Mark next step as active
            if (nextStep) {
                const nextStepIndicator = document.querySelector(`.step-indicator[data-step="${nextStep}"]`);
                if (nextStepIndicator) {
                    nextStepIndicator.classList.add('active');
                    nextStepIndicator.classList.remove('completed');
                }
            }
        }

        // Navigation
        async function nextStep() {
            // Handle conditional flow
            const currentSection = document.querySelector('.content-section.active');
            const currentSectionId = currentSection.id;
            const nextStepSection = determineNextStep();

            if (nextStepSection === 'submit') {
                // Mark current step as completed before submitting
                const currentStep = getSidebarStepNumber(currentSectionId);
                if (currentStep) {
                    const currentStepIndicator = document.querySelector(`.step-indicator[data-step="${currentStep}"]`);
                    if (currentStepIndicator) {
                        currentStepIndicator.classList.remove('active');
                        currentStepIndicator.classList.add('completed');
                    }
                }
                await submitRegistration();
                return;
            }

            // Update sidebar navigation
            updateSidebarNavigation(currentSectionId, nextStepSection);

            // Initialize next step if needed based on the actual section we're going to
            if (nextStepSection === 'step4Section') {
                initializeStep4();
            } else if (nextStepSection === 'step5Section') {
                initializeStep5();
            } else if (nextStepSection === 'step6Section') {
                initializeStep6();
            } else if (nextStepSection === 'step7Section') {
                initializeStep7();
            }

            // Hide current step
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show next step
            document.getElementById(nextStepSection).classList.add('active');

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function previousStep() {
            const prevStepSection = determinePreviousStep();

            // Hide current step
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show previous step
            document.getElementById(prevStepSection).classList.add('active');

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function determineNextStep() {
            const currentSection = document.querySelector('.content-section.active');
            const currentId = currentSection.id;

            switch(currentId) {
                case 'step1Section':
                    return 'step2Section';

                case 'step2Section':
                    // If attending, go to format selection; if not, go to designate alternate
                    return registrationState.primaryIsAttending ? 'step3aSection' : 'step4Section';

                case 'step3aSection':
                    return 'step3bSection';

                case 'step3bSection':
                    // If virtual, show virtual protocol; if in-person, go to employment
                    return registrationState.primaryFormat === 'virtual' ? 'step3bvSection' : 'step3cSection';

                case 'step3bvSection':
                    return 'step3cSection';

                case 'step3cSection':
                    // If designee, skip to submit (no adding another designee)
                    return isDesignee ? 'submit' : 'step4Section';

                case 'step4Section':
                    // If designating, go to selection; otherwise submit
                    return registrationState.hasDesignee ? 'step5Section' : 'submit';

                case 'step5Section':
                    return 'step6Section';

                case 'step6Section':
                    return 'step7Section';

                case 'step7Section':
                    return 'submit';

                default:
                    return 'step1Section';
            }
        }

        function determinePreviousStep() {
            const currentSection = document.querySelector('.content-section.active');
            const currentId = currentSection.id;

            switch(currentId) {
                case 'step2Section':
                    return 'step1Section';

                case 'step3aSection':
                    return 'step2Section';

                case 'step3bSection':
                    return 'step3aSection';

                case 'step3bvSection':
                    return 'step3bSection';

                case 'step3cSection':
                    // If virtual, came from virtual protocol; otherwise came from TLP Red
                    return registrationState.primaryFormat === 'virtual' ? 'step3bvSection' : 'step3bSection';

                case 'step4Section':
                    // If primary attending, came from employment; otherwise came from step 2
                    return registrationState.primaryIsAttending ? 'step3cSection' : 'step2Section';

                case 'step5Section':
                    return 'step4Section';

                case 'step6Section':
                    return 'step5Section';

                case 'step7Section':
                    return 'step6Section';

                default:
                    return 'welcomeSection';
            }
        }

        async function submitRegistration() {
            showLoading();

            try {
                // Upload files first
                const uploadedFiles = await uploadFiles();

                let response;

                if (isDesignee) {
                    // Submit designee agreement
                    response = await fetch('/api/submit-designee-agreement', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            designeeToken: token,
                            registrationId: registrationId,
                            tlpRedSignatureUrl: uploadedFiles.tlpRedAgreement,
                            employmentSignatureUrl: uploadedFiles.employmentAgreement,
                            virtualProtocolSignatureUrl: uploadedFiles.virtualProtocol || null,
                            attendanceFormat: registrationState.primaryFormat
                        })
                    });
                } else {
                    // Submit primary member registration
                    response = await fetch('/api/submit-summit-registration', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            token: token,
                            organizationId: organizationData.id,
                            primaryContactId: primaryMemberContact?.id || null,
                            primaryIsAttending: registrationState.primaryIsAttending,
                            primaryFormat: registrationState.primaryFormat,
                            tlpRedSignatureUrl: uploadedFiles.tlpRedAgreement,
                            employmentSignatureUrl: uploadedFiles.employmentAgreement,
                            virtualProtocolSignatureUrl: uploadedFiles.virtualProtocol || null,
                            hasDesignee: registrationState.hasDesignee,
                            designeeContact: registrationState.designeeContact,
                            designeeIsNew: registrationState.designeeIsNew || false,
                            designeeFormat: registrationState.designeeFormat,
                            certificationUrl: uploadedFiles.certification
                        })
                    });
                }

                const result = await response.json();

                if (result.success) {
                    initializeStep8();
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById('step8Section').classList.add('active');
                    hideLoading();
                } else {
                    throw new Error(result.error || 'Submission failed');
                }
            } catch (error) {
                console.error('Submission error:', error);
                alert('Error submitting registration. Please try again.');
                hideLoading();
            }
        }

        async function uploadFiles() {
            const files = [];

            // Get TLP Red signature
            if (tlpRedHasSignature && tlpRedSignaturePad) {
                const tlpRedDataUrl = tlpRedSignaturePad.toDataURL('image/png');
                const tlpRedBase64 = tlpRedDataUrl.split(',')[1];

                files.push({
                    name: `tlp_red_signature_${Date.now()}.png`,
                    content: tlpRedBase64,
                    type: 'image/png',
                    fieldName: 'tlpRedAgreement'
                });
            }

            // Get Employment signature
            if (employmentHasSignature && employmentSignaturePad) {
                const employmentDataUrl = employmentSignaturePad.toDataURL('image/png');
                const employmentBase64 = employmentDataUrl.split(',')[1];

                files.push({
                    name: `employment_signature_${Date.now()}.png`,
                    content: employmentBase64,
                    type: 'image/png',
                    fieldName: 'employmentAgreement'
                });
            }

            // Get Virtual Protocol signature (only for virtual attendees)
            if (virtualProtocolHasSignature && virtualProtocolSignaturePad) {
                const virtualProtocolDataUrl = virtualProtocolSignaturePad.toDataURL('image/png');
                const virtualProtocolBase64 = virtualProtocolDataUrl.split(',')[1];

                files.push({
                    name: `virtual_protocol_signature_${Date.now()}.png`,
                    content: virtualProtocolBase64,
                    type: 'image/png',
                    fieldName: 'virtualProtocol'
                });
            }

            // Get Certification signature (only if designee exists)
            if (certificationHasSignature && certificationSignaturePad) {
                const certificationDataUrl = certificationSignaturePad.toDataURL('image/png');
                const certificationBase64 = certificationDataUrl.split(',')[1];

                files.push({
                    name: `certification_signature_${Date.now()}.png`,
                    content: certificationBase64,
                    type: 'image/png',
                    fieldName: 'certification'
                });
            }

            if (files.length === 0) return {};

            const response = await fetch('/api/upload-summit-files', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    files: files,
                    organizationName: organizationData.organization?.name,
                    token: token
                })
            });

            const result = await response.json();

            if (!response.ok) {
                console.error('❌ File upload failed:', result);
                throw new Error(result.error || 'File upload failed');
            }

            return result.urls || {};
        }
    </script>

    <!-- Signature Modals -->
    <div id="tlpRedSignatureModal" class="signature-modal-overlay">
        <div class="signature-modal-content">
            <div class="signature-modal-header">
                <h2 class="signature-modal-title">Sign Traffic Light Protocol Red Agreement</h2>
                <p class="signature-modal-subtitle">Please sign below to acknowledge your agreement</p>
            </div>
            <div class="signature-modal-body">
                <div class="signature-pad-container">
                    <canvas id="tlpRedSignatureCanvas" class="signature-canvas"></canvas>
                </div>
            </div>
            <div class="signature-modal-footer">
                <button class="modal-cancel-btn" onclick="closeTLPRedSignatureModal()">Cancel</button>
                <button class="clear-signature-btn" onclick="clearTLPRedSignature()">Clear</button>
                <button class="modal-save-btn" onclick="saveTLPRedSignature()" id="tlpRedSaveBtn" disabled>Save Signature</button>
            </div>
        </div>
    </div>

    <div id="employmentSignatureModal" class="signature-modal-overlay">
        <div class="signature-modal-content">
            <div class="signature-modal-header">
                <h2 class="signature-modal-title">Sign Employment Contract Acknowledgment</h2>
                <p class="signature-modal-subtitle">I have reviewed applicable employment contracts and accept responsibility for any conflicts</p>
            </div>
            <div class="signature-modal-body">
                <div class="signature-pad-container">
                    <canvas id="employmentSignatureCanvas" class="signature-canvas"></canvas>
                </div>
            </div>
            <div class="signature-modal-footer">
                <button class="modal-cancel-btn" onclick="closeEmploymentSignatureModal()">Cancel</button>
                <button class="clear-signature-btn" onclick="clearEmploymentSignature()">Clear</button>
                <button class="modal-save-btn" onclick="saveEmploymentSignature()" id="employmentSaveBtn" disabled>Save Signature</button>
            </div>
        </div>
    </div>

    <!-- Virtual Protocol Signature Modal -->
    <div id="virtualProtocolSignatureModal" class="signature-modal-overlay">
        <div class="signature-modal-content">
            <div class="signature-modal-header">
                <h2 class="signature-modal-title">Sign Virtual Attendance Protocol</h2>
                <p class="signature-modal-subtitle">I acknowledge and accept all mandatory virtual attendance requirements</p>
            </div>
            <div class="signature-modal-body">
                <div class="signature-pad-container">
                    <canvas id="virtualProtocolSignatureCanvas" class="signature-canvas"></canvas>
                </div>
            </div>
            <div class="signature-modal-footer">
                <button class="modal-cancel-btn" onclick="closeVirtualProtocolSignatureModal()">Cancel</button>
                <button class="clear-signature-btn" onclick="clearVirtualProtocolSignature()">Clear</button>
                <button class="modal-save-btn" onclick="saveVirtualProtocolSignature()" id="virtualProtocolSaveBtn" disabled>Save Signature</button>
            </div>
        </div>
    </div>

    <!-- Certification Signature Modal -->
    <div id="certificationSignatureModal" class="signature-modal-overlay">
        <div class="signature-modal-content">
            <div class="signature-modal-header">
                <h2 class="signature-modal-title">Sign Primary Member Certification</h2>
                <p class="signature-modal-subtitle">I certify the statements above regarding my designated alternate</p>
            </div>
            <div class="signature-modal-body">
                <div class="signature-pad-container">
                    <canvas id="certificationSignatureCanvas" class="signature-canvas"></canvas>
                </div>
            </div>
            <div class="signature-modal-footer">
                <button class="modal-cancel-btn" onclick="closeCertificationSignatureModal()">Cancel</button>
                <button class="clear-signature-btn" onclick="clearCertificationSignature()">Clear</button>
                <button class="modal-save-btn" onclick="saveCertificationSignature()" id="certificationSaveBtn" disabled>Save Signature</button>
            </div>
        </div>
    </div>

    <!-- Primary Member Edit Modal -->
    <div id="primaryMemberModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Your Details</h2>
                <button class="modal-close" onclick="closePrimaryMemberModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-field">
                    <label>Name <span class="required">*</span></label>
                    <input type="text" id="pmName" placeholder="Enter your full name">
                    <div class="error-message" id="pmNameError">Name is required</div>
                </div>
                <div class="modal-field">
                    <label>Title <span class="required">*</span></label>
                    <input type="text" id="pmTitle" placeholder="Enter your title">
                    <div class="error-message" id="pmTitleError">Title is required</div>
                </div>
                <div class="modal-field">
                    <label>Email <span class="required">*</span></label>
                    <input type="email" id="pmEmail" placeholder="Enter your email">
                    <div class="error-message" id="pmEmailError">Valid email is required</div>
                </div>
                <div class="modal-field">
                    <label>Phone <span class="required">*</span></label>
                    <input type="tel" id="pmPhone" placeholder="(XXX) XXX-XXXX">
                    <div class="error-message" id="pmPhoneError">Valid phone number is required</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-cancel-btn" onclick="closePrimaryMemberModal()">Cancel</button>
                <button class="modal-save-btn" onclick="savePrimaryMemberDetails()">Save Changes</button>
            </div>
        </div>
    </div>

</body>
</html>
